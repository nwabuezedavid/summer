// prisma/schema.prisma
// Full Investment Platform Schema (Dashboard Ready)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////
// USER
//////////////////////
model User {
  id            Int      @id @default(autoincrement())
  uuid          String   @unique @default(uuid())
  username      String   @unique
  email         String   @unique
  password      String

  avatar        String?  // Profile image

  token         String?  @unique @default(uuid())
  fullName      String?
  phone         String?
  country       String?
  address       String?

  isActive      Boolean  @default(true)
  isVerified    Boolean  @default(false) // KYC
  rank          UserRank @default(LEVEL_1)
  UserType          Usertype @default(USER)

  mainBalance   Decimal  @default(0)
  profitBalance Decimal  @default(0)

  investments   Investment[]
  deposits      Deposit[]
  withdrawals   Withdrawal[]
  transfers     Transfer[]
  bonuses       Bonus[]
  transactions  Transaction[]
  tickets       SupportTicket[]
  notifications Notification[]

  // Referral system
  referralCode  String? @unique
  referredById  Int?
  referredBy    User?   @relation("Referrals", fields: [referredById], references: [id])
  referrals     User[]  @relation("Referrals")

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

//////////////////////
// INVESTMENT PLANS
//////////////////////
model InvestmentPlan {
  id            Int      @id @default(autoincrement())
  name          String
  description   String?

  image         String?  // Plan image (Bronze / Silver / Gold)

  minAmount     Decimal
  maxAmount     Decimal
  profitPercent Decimal
  durationDays  Int

  isActive      Boolean  @default(true)
  investments   Investment[]

  createdAt     DateTime @default(now())
}

model Investment {
  id        Int      @id @default(autoincrement())
  userId    Int
  planId    Int

  amount    Decimal
  profit    Decimal
  status    InvestmentStatus @default(RUNNING)

  startedAt DateTime @default(now())
  endsAt    DateTime

  user      User            @relation(fields: [userId], references: [id])
  plan      InvestmentPlan  @relation(fields: [planId], references: [id])
}

//////////////////////
// DEPOSIT & WITHDRAWAL
//////////////////////
model Deposit {
  id        Int      @id @default(autoincrement())
  userId    Int
  amount    Decimal
  crypto    CryptoType
  txHash    String?  @unique

  proof     String?  // Proof of payment image

  status    TransactionStatus @default(PENDING)

  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}

model Withdrawal {
  id        Int      @id @default(autoincrement())
  userId    Int
  amount    Decimal
  crypto    CryptoType
  wallet    String

  proof     String?  // Proof image (admin optional)

  status    TransactionStatus @default(PENDING)

  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}

//////////////////////
// TRANSFER
//////////////////////
model Transfer {
  id         Int        @id @default(autoincrement())
  userId     Int
  amount     Decimal
  fromWallet WalletType
  toWallet   WalletType

  note       String?   // Send money note
  proof      String?   // Proof image

  user       User      @relation(fields: [userId], references: [id])
  createdAt  DateTime  @default(now())
}

//////////////////////
// BONUS SYSTEM
//////////////////////
model Bonus {
  id        Int      @id @default(autoincrement())
  userId    Int
  amount    Decimal
  type      BonusType
  note      String?

  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}

//////////////////////
// TRANSACTIONS (RECENT ACTIVITY)
//////////////////////
model Transaction {
  id        Int      @id @default(autoincrement())
  userId    Int
  title     String
  type      TransactionType
  amount    Decimal
  fee       Decimal @default(0)
  status    TransactionStatus
  gateway   String?

  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}

//////////////////////
// BADGES / RANKS
//////////////////////
model Badge {
  id          Int      @id @default(autoincrement())
  title       String   // Hype Member, Hype Leader, etc.
  image       String   // Badge image
  requirement Decimal  // Required earnings
  rank        UserRank

  createdAt   DateTime @default(now())
}

//////////////////////
// SUPPORT TICKETS
//////////////////////
model Wallet {
  id        Int      @id @default(autoincrement())
  name    Int
  address   String
  
  createdAt DateTime @default(now())
}
model SupportTicket {
  id        Int      @id @default(autoincrement())
  userId    Int
  subject   String
  message   String
  status    TicketStatus @default(OPEN)

  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}

//////////////////////
// NOTIFICATIONS
//////////////////////
model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  title     String
  message   String
  isRead    Boolean  @default(false)

  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}

//////////////////////
// ENUMS
//////////////////////
enum TransactionStatus {
  PENDING
  APPROVED
  REJECTED
}

enum InvestmentStatus {
  RUNNING
  COMPLETED
  CANCELLED
}
enum Usertype {
  USER
  ADMIN
   
}

enum CryptoType {
  BTC
  ETH
  USDT
  BNB
  TRX
}

enum WalletType {
  MAIN
  PROFIT
}

enum BonusType {
  REFERRAL
  DEPOSIT
  INVESTMENT
  RANKING
}

enum TransactionType {
  DEPOSIT
  WITHDRAW
  TRANSFER
  INVESTMENT
  BONUS
}

enum TicketStatus {
  OPEN
  CLOSED
}

enum UserRank {
  LEVEL_1
  LEVEL_2
  LEVEL_3
  VIP
}
